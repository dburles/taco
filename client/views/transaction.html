<template name="transaction">



    {{#with transaction}}
    <div class="row">
        <div class="col-sm-12 margin-top-10 margin-bottom-10">
            <h1 class="ellipsis">
                <a href="/">
                <i class="fa fa-chevron-circle-left coloured small-right-margin"></i></a>{{client}}
            </h1>
        </div>
    </div>

    {{description}}

        <div class="row">
            <div class="col-sm-12">
                <ul id="stage-tabs" class="sortable-activities nav nav-tabs">
                    {{#each stages}}
                        <li class="stage-tab {{isTabActive}}" role="presentation"><a  href="#">{{title}}</a></li>
                    {{/each}}
                    <li role="presentation" class="unsortable">
                        {{#if addingStage}}
                            <input type="text" style="margin-top:4px;" class="form-control" id="add-stage-text"/>
                        {{else}}
                            <a id="add-stage-link" href="#">+</a>
                        {{/if}}

                    </li>
                </ul>
            </div>
        </div>

        <div class="row top-margin">


            <div class="col-sm-4">

            {{> transactionSteps}}

            </div>
            <div class="col-sm-6">

            {{> transactionDetail}}

            </div>
            <div class="col-sm-2">

                <ul class="tiles tiles-dark">
                    {{#each members}}
                    <li>
                        <i class="fa fa-2x fa-user pull-left" style="margin-top: -5px"></i>
                        {{contactName}}
                    </li>
                    {{/each}}

                </ul>

            </div>
        </div>
    {{/with}}

    {{#if Template.subscriptionsReady}}

    {{else}}
        {{> loader}}
    {{/if}}

</template>

<template name="transactionSteps">


    <ul id="steps" class="sortable-activities tiles tiles-light">

        {{#each steps}}
            {{#if isSection}}
                <li class="color-white background-grey" style="padding-top:4px;padding-bottom:4px; border-top: solid 5px white">
                    {{title}}
                </li>
            {{else}}
                <li class="step-item tile hover-box {{isStepActive}}">
                    {{#if completed}}
                        <i  class="fa fa-2x green fa-check-circle pull-right above-top"></i>
                    {{/if}}
                    {{title}}

                    <br/>
                    {{bars}}

                    <!--<div class="progress" style="height:3px;background-color:#BDBDBD;margin-bottom:5px;margin-top: 3px">-->
                        <!--<div class="progress-bar" role="progressbar" aria-valuenow="30"-->
                             <!--aria-valuemin="0" aria-valuemax="100" style="width:70%">-->
                            <!--<span class="sr-only">70% Complete</span>-->
                        <!--</div>-->

                    <!--</div>-->
                </li>
            {{/if}}
        {{/each}}
        {{#if queryParamExists 'stage'}}
        <li class="tile unsortable">
            <input placeholder="Add a step..." type="text" style="margin-top:4px;" class="form-control" id="add-step-text"/>
        </li>
        {{/if}}
    </ul>
    {{#if Template.subscriptionsReady}}

    {{else}}
        {{> loader}}
    {{/if}}
</template>

<template name="transactionDetail">
    {{#with step}}
        {{#if hasType 'Public'}}
            <span class="label label-default">Public</span>
        {{/if}}

        <div class="inline-block pull-right">
            {{#if equals this.status 'Completed'}}
                <i class="fa fa-4x fa-check-circle color-green" style="margin-right: 17px"></i>
            {{else}}
                {{> stepChart}}
            {{/if}}
        </div>
        <h2 style="margin-top: 0">{{title}}</h2>


        <table class="inline-block">
            <tr>

                <td  valign="top">

                    {{> assignButton}}



                </td>
                <td style="padding-left: 4px">
                    {{> scheduler this}}

                </td>
            </tr>
        </table>




    {{/with}}



    <ul class="tiles bottom-margin">

        {{#each tasks}}
        <li>
            {{#if statusCompleted}}
                <div class="btn-group pull-right" style="padding-right:15px;">

                    <button type="button" class="btn btn-transparent dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                        <i class="fa fa-2x fa-check-circle color-green"></i>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a class="outstanding-menu" href="">Mark as Outstanding</a></li>
                    </ul>
                </div>

            {{else}}
            <div class="btn-group pull-right">

                <button id="activity-action" type="button" class="btn btn-default btn-fixed">Done</button>
                <!--<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">-->
                    <!--<span class="caret"></span>-->
                    <!--<span class="sr-only">Toggle Dropdown</span>-->
                <!--</button>-->
                <!--<ul class="dropdown-menu" role="menu">-->
                    <!--<li><a href="#">Complete</a></li>-->
                    <!--<li><a href="#">Not Applicable</a></li>-->
                    <!--<li class="divider"></li>-->
                    <!--<li><a href="#">Edit Task</a></li>-->
                <!--</ul>-->
            </div>
            {{/if}}
            {{title}}
        </li>
        {{/each }}
    </ul>
    {{#if queryParamExists 'step'}}
        <textarea placeholder="Add a comment..." class="form-control margin-bottom-10" id="comment-text" rows="2"></textarea>
    {{/if}}
    <ul class="tiles bottom-margin">
        {{#each comments}}
        <li>
            <img class="img-rounded small-right-margin pull-left" style="width:30px;height:30px" src="/images/matt.ireland.jpg" alt=""/>
            {{description}}
            <span class="text-muted"> - {{fromNow updatedAt}}</span>

        </li>
        {{/each}}
    </ul>
</template>

<template name="scheduler">
    <div class="btn-group">
        {{#each upcomingDays}}
            <button class="day-button btn btn-default {{dayClass}}">
                {{initial}}
            </button>
        {{/each}}
        <button id="date-expand" class="btn btn-default">
            <span class="caret"></span>
        </button>
    </div>
    <div class="datepicker" data-date="{{formatDate due 'short'}}" style="display:none"></div>
    <div class="color-grey" style="padding-top: 4px">Due {{fromNow due}}</div>
</template>




<template name="assignButton">

    <button type="button" class="btn btn-default" data-toggle="popover" data-placement="bottom" data-html="true" title="Assign To" >
        <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
             alt=""/>
        <!--class="img-rounded img-thumbnail pull-left"-->

    </button>




    <div id="popover-content" class="hide">
        <div>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
        </div>
        <div>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
        </div>
        <div>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
        </div>
    </div>
</template>

<template name="stepChart">
    <canvas id="myChart" width="90" height="60"></canvas>
</template>