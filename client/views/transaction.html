<template name="transaction">



    {{#with transaction}}

    <div class="row">
        <div class="col-sm-12 margin-top-10 margin-bottom-10">
            <h1 class="ellipsis">
                <a href="/">
                <i class="fa fa-chevron-circle-left color-blue small-right-margin"></i></a>{{client}}
            </h1>
        </div>
    </div>

        <div class="row">
            <div class="col-sm-12">
                <ul id="stage-tabs" class="sortable-activities nav nav-tabs">
                    {{#each stages}}
                        <li class="stage-tab {{isTabActive}}" role="presentation"><a  href="#">{{text}}</a></li>
                    {{/each}}
                    <li role="presentation" class="unsortable">
                        {{#if addingStage}}
                            <input type="text" style="margin-top:4px;" class="form-control" id="add-stage-text"/>
                        {{else}}
                            <a id="add-stage-link" href="#">+</a>
                        {{/if}}

                    </li>
                </ul>
            </div>
        </div>

        <div class="row top-margin">
            <div class="col-lg-9">
                <div class="row">
                    <div class="col-sm-5">
                        {{#if queryParam 'stage'}}
                            {{> transactionSteps}}
                        {{else}}
                            {{> transactionSummary}}
                        {{/if}}
                    </div>
                    <div class="col-sm-7">
                        {{#if queryParam 'step'}}
                            {{> transactionDetail}}
                        {{else}}
                            {{> stageSummary}}
                        {{/if}}
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                {{> transactionMembers}}
            </div>

        </div>
    {{/with}}

    {{#unless Template.subscriptionsReady}}
        {{> loader}}
    {{/unless}}

</template>

<template name="transactionSteps">


    <ul id="steps" class="sortable-activities tiles tiles-light">

        {{#each steps}}
            {{#if isSection}}
                <li class="color-white background-grey" style="padding-top:4px;padding-bottom:4px; border-top: solid 5px white">
                    {{text}}
                </li>
            {{else}}
                <li class="step-item tile hover-box {{isStepActive}}">
                    {{#if completed}}
                        <i  class="fa fa-2x green fa-check-circle pull-right above-top"></i>
                    {{/if}}
                    {{#if hasType 'Important'}}
                        <span class="label label-primary">Important</span>&nbsp;
                    {{/if}}
                    {{text}}

                    <br/>
                    {{bars}}
                </li>
            {{/if}}
        {{/each}}
        {{#if queryParamExists 'stage'}}
        <li class="tile unsortable">
            <input placeholder="Add a step..." type="text" style="margin-top:4px;" class="form-control" id="add-step-text"/>
        </li>
        {{/if}}
    </ul>
    <!--{{#unless Template.subscriptionsReady}}-->
        <!--{{> loader}}-->
    <!--{{/unless}}-->
</template>

<template name="transactionDetail">
    {{#with step}}
        {{#if hasType 'Public'}}
            <span class="label label-default">Public</span>
        {{/if}}

        <div class="inline-block pull-right">
            {{#if equals this.status 'Completed'}}
                <i class="fa fa-4x fa-check-circle color-green" style="margin-right: 17px"></i>
            {{else}}
                {{> stepChart}}
            {{/if}}
        </div>
        <!--<h2 style="margin-top: 0">{{text}}</h2>-->


        <div class="dropdown hover-box drop-heading">
            <div href="#" class="dropdown-toggle" id="titleDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                <h2 class="ellipsis margin-right-5" style="display: inline">{{text}}</h2>
                <i class="fa fa-2x fa-caret-down light-text inline-block"></i>
            </div>

            <ul class="dropdown-menu pull-right" aria-labelledby="titleDropdown">
                <li><a class="important-menu" href="#">Important</a></li>
            </ul>
        </div>






        <table class="inline-block">
            <tr>
                <td  valign="top">
                    {{> assignButton}}
                </td>
                <td style="padding-left: 4px">
                    {{> scheduler this}}
                </td>
            </tr>
        </table>

    {{/with}}



    <ul class="tiles bottom-margin">

        {{#each tasks}}
        <li>

            {{#if statusIs 'Completed'}}
                <div class="btn-group pull-right" style="padding-right:15px;">

                    <button type="button" class="btn btn-transparent dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                        <i class="fa fa-2x fa-check-circle color-green"></i>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a class="outstanding-menu" href="">Mark as Outstanding</a></li>
                    </ul>
                </div>
                {{formattedTaskText}} <span class="color-light-grey"> - {{fromNow updatedAt}}</span>
            {{/if}}

            {{#if statusIs 'Outstanding'}}
                <div class="btn-group pull-right">

                    <button id="activity-action" type="button" class="btn btn-default btn-fixed">Done</button>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a class="important-menu" href="#">Important</a></li>
                        <li><a class="promote-step-menu" href="#">Promote to Step</a></li>
                        <li><a class="not-applicable-menu" href="#">Not Applicable</a></li>
                        <li class="divider"></li>
                        <li><a class="delete-activity-menu" href="#">Delete Task</a></li>
                    </ul>
                </div>
                {{formattedTaskText}}
            {{/if}}

            {{#if statusIs 'Not Applicable'}}
                <div class="btn-group pull-right" style="padding-right:15px;">

                    <button type="button" class="btn btn-transparent dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                        <i class="fa fa-2x fa-check-circle color-grey"></i>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a class="outstanding-menu" href="">Mark as Outstanding</a></li>
                    </ul>
                </div>
                {{formattedTaskText}}
            {{/if}}


        </li>
        {{/each }}
    </ul>
    {{#if queryParamExists 'step'}}
        <textarea placeholder="Add a comment..." class="form-control margin-bottom-10" id="comment-text" rows="2"></textarea>
    {{/if}}

    <ul class="tiles bottom-margin">
        {{#each comments}}
        <li>
            <img class="img-rounded small-right-margin pull-left" style="width:30px;height:30px" src="/images/matt.ireland.jpg" alt=""/>

            <div class="btn-group pull-right dropup">
                <button type="button" class="btn btn-default btn-transparent dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="color-grey fa fa-chevron-down"></i>
                    <!--<span class="sr-only">Toggle Dropdown</span>-->
                </button>
                <ul class="dropdown-menu">
                    <li><a class="delete-activity-menu" href="#">Delete Comment</a></li>
                    <li><a class="edit-comment-menu" href="#">Edit Comment</a></li>
                    <li><a class="convert-task-menu" href="#">Convert to Task</a></li>
                    <li><a class="important-menu" href="#">Important</a></li>
                </ul>
            </div>

            {{#if hasType 'Important'}}
                <span class="label label-primary">Important</span>&nbsp;
            {{/if}}

            {{text}}
            <span class="color-light-grey"> - {{fromNow updatedAt}}</span>

        </li>
        {{/each}}
    </ul>
    {{#unless Template.subscriptionsReady}}
        {{> loader}}
    {{/unless}}

</template>

<template name="scheduler">
    <div class="btn-group">
        {{#each upcomingDays}}
            <button class="day-button btn btn-default {{dayClass}}">
                {{initial}}
            </button>
        {{/each}}
        <button id="date-expand" class="btn btn-default">
            <span class="caret"></span>
        </button>
    </div>
    <div class="datepicker" data-date="{{formatDate due 'short'}}" style="display:none"></div>
    <div style="color:{{colour due}};padding-top: 4px; padding-left:3px;">Due {{fromNow due}}</div>
</template>




<template name="assignButton">

    <button type="button" class="btn btn-default" style="padding:2px;" data-toggle="popover" data-placement="bottom" data-html="true" title="Assign To" >
        <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
             alt=""/>
        <!--class="img-rounded img-thumbnail pull-left"-->

    </button>




    <div id="popover-content" class="hide">
        <div>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
        </div>
        <div>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
        </div>
        <div>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
            <img style="width:50px;height:50px" src="/images/matt.ireland.jpg"
                 alt=""/>
        </div>
    </div>
</template>

<template name="transactionMembers">
    <ul class="tiles tiles-dark margin-bottom-10">
        {{#each members}}
            <li>
                <i class="fa fa-2x fa-user pull-left" style="margin-top: -5px"></i>


                <div class="btn-group pull-right" style="margin-top: -5px">
                    <button type="button" class="btn btn-default btn-transparent dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="color-white fa fa-chevron-down"></i>
                        <!--<span class="sr-only">Toggle Dropdown</span>-->
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="remove-association-menu" href="#">Remove Association</a></li>
                        <li><a class="edit-contact-menu" href="#">Edit Contact</a></li>
                    </ul>
                </div>

                <b>{{contactName}}</b> | {{role}}
            </li>
        {{/each}}

    </ul>
    <div class="btn-group pull-right">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Add Contact <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li><a class="add-role-menu" href="#">Client</a></li>
            <li><a class="add-role-menu" href="#">Agent</a></li>
            <li><a class="add-role-menu" href="#">Solicitor</a></li>
            <li role="separator" class="divider"></li>
            <li><a class="add-role-menu" href="#">Other</a></li>
        </ul>
    </div>

</template>

<template name="stepChart">
    <canvas id="myChart" width="90" height="60"></canvas>
</template>

<template name="stageSummary">
    <h2>{{title}}</h2>
    <p>{{description}}</p>
</template>

<template name="transactionSummary">
    <div class="well">Transaction Overview Here...</div>
</template>

